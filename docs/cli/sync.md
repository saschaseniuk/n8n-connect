# n8n-connect sync

Generate TypeScript type definitions from n8n workflow schemas.

## Overview

The `sync` command connects to your n8n instance and generates TypeScript interfaces based on your workflow definitions. This enables:

- Full autocompletion for webhook inputs
- Type-safe workflow responses
- Compile-time validation

## Status

This feature is **experimental**. The CLI and generated types may change.

## Usage

```bash
npx n8n-connect sync [options]
```

## Options

### --workflow-id, -w

**Type**: `string | number`

**Required**: Yes (unless using --all)

The n8n workflow ID to generate types for.

```bash
npx n8n-connect sync --workflow-id 12
```

### --all

Generate types for all workflows.

```bash
npx n8n-connect sync --all
```

### --output, -o

**Type**: `string`

**Default**: `./types/n8n.d.ts`

Output file path for generated types.

```bash
npx n8n-connect sync -w 12 --output ./src/types/workflows.d.ts
```

### --url

**Type**: `string`

n8n instance URL. Overrides N8N_BASE_URL environment variable.

```bash
npx n8n-connect sync -w 12 --url https://n8n.example.com
```

### --token

**Type**: `string`

API token for authentication. Overrides N8N_API_TOKEN environment variable.

```bash
npx n8n-connect sync -w 12 --token your-api-token
```

### --watch

Watch for workflow changes and regenerate types automatically.

```bash
npx n8n-connect sync -w 12 --watch
```

## Environment Variables

Configure the CLI using environment variables:

```bash
# .env or .env.local
N8N_BASE_URL=https://n8n.example.com
N8N_API_TOKEN=your-api-token
```

## Examples

### Basic Usage

```bash
# Generate types for workflow 12
npx n8n-connect sync --workflow-id 12
```

### With Custom Output

```bash
npx n8n-connect sync -w 12 -o ./src/types/order-workflow.d.ts
```

### Multiple Workflows

```bash
# Generate separate files
npx n8n-connect sync -w 12 -o ./types/orders.d.ts
npx n8n-connect sync -w 15 -o ./types/notifications.d.ts

# Or generate all in one file
npx n8n-connect sync --all -o ./types/n8n.d.ts
```

### In package.json

```json
{
  "scripts": {
    "types:n8n": "n8n-connect sync --all --output ./src/types/n8n.d.ts",
    "types:n8n:watch": "n8n-connect sync --all --watch"
  }
}
```

## Generated Types

The command generates TypeScript interfaces like this:

```typescript
// Auto-generated by n8n-connect sync
// Do not edit manually

declare module '@n8n-connect/workflows' {
  export interface CreateOrderInput {
    productId: string;
    quantity: number;
    customerId?: string;
  }

  export interface CreateOrderOutput {
    orderId: string;
    total: number;
    status: 'pending' | 'confirmed';
    createdAt: string;
  }

  export interface WorkflowTypes {
    'create-order': {
      input: CreateOrderInput;
      output: CreateOrderOutput;
    };
    'send-notification': {
      input: SendNotificationInput;
      output: SendNotificationOutput;
    };
  }
}
```

## Using Generated Types

After generating types, use them with the hook:

```typescript
import type { WorkflowTypes } from '@n8n-connect/workflows';
import { useWorkflow } from '@n8n-connect/react';

// Type-safe hook
const { execute, data } = useWorkflow<
  WorkflowTypes['create-order']['input'],
  WorkflowTypes['create-order']['output']
>('create-order');

// Autocomplete and validation for inputs
execute({
  data: {
    productId: 'prod_123', // TypeScript knows this is required
    quantity: 2,           // TypeScript knows this must be a number
  },
});

// Autocomplete for outputs
if (data) {
  console.log(data.orderId); // TypeScript knows this exists
  console.log(data.status);  // TypeScript knows valid values
}
```

## Type Generation Details

Types are inferred from:

1. **Webhook Node Configuration**: Input fields defined in the webhook node
2. **Respond to Webhook Node**: Output structure from the response configuration
3. **Set Node Values**: Data transformations in the workflow
4. **Code Node Types**: TypeScript/JavaScript type annotations

### Limitations

- Complex dynamic schemas may not be fully captured
- Conditional outputs require manual type unions
- External API responses need manual typing

## Troubleshooting

### Authentication Failed

Ensure your API token has workflow read permissions:

```bash
# Check token is set
echo $N8N_API_TOKEN

# Or pass directly
npx n8n-connect sync -w 12 --token "your-token"
```

### Workflow Not Found

Verify the workflow ID exists and is accessible:

```bash
# List available workflows
npx n8n-connect list
```

### Type Generation Issues

For complex workflows, you may need to supplement generated types:

```typescript
// types/n8n-overrides.d.ts
import type { WorkflowTypes } from '@n8n-connect/workflows';

// Extend or override generated types
declare module '@n8n-connect/workflows' {
  interface CreateOrderOutput {
    // Add fields not detected by sync
    metadata?: Record<string, unknown>;
  }
}
```

## Related

- [CLI Overview](./README.md)
- [TypeScript Configuration](../getting-started/configuration.md#typescript-configuration)
- [Workflow Types](../core/types/workflow.md)
